<%- include('../../partials/modal-styles') %>

<div class="modal-content-wrapper">
  <h2>Edit Allowed IP</h2>

  <form method="POST" action="/admin/security/ip-restrictions/<%= entry.id %>?_method=PUT" id="editIpForm">
    <div class="row g-3">
      <div class="col-md-6">
        <label for="editIpAddress" class="form-label">IP Address <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="editIpAddress" name="ip_address" required value="<%= entry.ip_address %>">
        <div class="invalid-feedback">Please enter a valid IPv4 or IPv6 address.</div>
      </div>
      <div class="col-md-6">
        <label for="editLabel" class="form-label">Label</label>
        <input type="text" class="form-control" id="editLabel" name="label" maxlength="255" value="<%= entry.label || '' %>">
      </div>
      <div class="col-12">
        <label for="editNotes" class="form-label">Notes</label>
        <textarea class="form-control" id="editNotes" name="notes" rows="3"><%= entry.notes || '' %></textarea>
      </div>
      <div class="col-12">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="true" id="editIsActive" name="is_active" <%= entry.is_active ? 'checked' : '' %>>
          <label class="form-check-label" for="editIsActive">Entry is active</label>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-2 button-group">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-save"></i> Update IP
      </button>
    </div>
  </form>
</div>

<script>
  (function() {
    const ipv4Pattern = /^(25[0-5]|2[0-4]\d|1?\d?\d)(\.(25[0-5]|2[0-4]\d|1?\d?\d)){3}$/;
    const ipv6Pattern = /^(([0-9a-fA-F]{1,4}:){7}([0-9a-fA-F]{1,4}|:)|(([0-9a-fA-F]{1,4}:){1,7}:)|(([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4})|(([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2})|(([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3})|(([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4})|(([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5})|([0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6}))|(:(:[0-9a-fA-F]{1,4}){1,7})|(fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,})|(::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}\d|)[0-9])\.){3}(25[0-5]|(2[0-4]|1{0,1}\d|)[0-9]))|(([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}\d|)[0-9])\.){3}(25[0-5]|(2[0-4]|1{0,1}\d|)[0-9]))$/;
    function isValidIp(value) {
      const trimmed = (value || '').trim();
      return ipv4Pattern.test(trimmed) || ipv6Pattern.test(trimmed);
    }
    const form = document.getElementById('editIpForm');
    if (form) {
      form.addEventListener('submit', function(e) {
        const ipField = document.getElementById('editIpAddress');
        if (!isValidIp(ipField.value)) {
          e.preventDefault();
          ipField.classList.add('is-invalid');
        } else {
          ipField.classList.remove('is-invalid');
        }
      });
    }
  })();
</script>

